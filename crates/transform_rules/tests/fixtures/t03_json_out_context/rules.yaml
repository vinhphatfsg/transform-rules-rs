version: 1
input:
  format: json
  json:
    records_path: "items"
mappings:
  - target: "id"
    source: "id"
  - target: "price"
    source: "price"
    type: "float"
  - target: "text"
    expr:
      op: "concat"
      args:
        - { ref: "out.id" }
        - "-"
        - { ref: "out.price" }
  - target: "tenant"
    expr:
      chain:
        - { ref: "context.tenant_master" }
        - { op: "find", args: [ { op: "==", args: [ { ref: "item.value.id" }, { ref: "out.id" } ] } ] }
        - { op: "get", args: [ "tenant_id" ] }
        - { op: "replace", args: [ "-", "_" , "all" ] }
